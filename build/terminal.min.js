/**
 * almond 0.1.3 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * Copyright © 2012 Ramón Lamana
 */

(function(){var e,t,n;(function(r){function c(e,t){var n,r,i,s,o,u,f,l,c,h,p=t&&t.split("/"),d=a.map,v=d&&d["*"]||{};if(e&&e.charAt(0)==="."&&t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))return!0;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],f=l)}!s&&u&&(s=u,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function h(e,t){return function(){return s.apply(r,l.call(arguments,0).concat([e,t]))}}function p(e){return function(t){return c(t,e)}}function d(e){return function(t){o[e]=t}}function v(e){if(u.hasOwnProperty(e)){var t=u[e];delete u[e],f[e]=!0,i.apply(r,t)}if(!o.hasOwnProperty(e))throw new Error("No "+e);return o[e]}function m(e,t){var n,r,i=e.indexOf("!");return i!==-1?(n=c(e.slice(0,i),t),e=e.slice(i+1),r=v(n),r&&r.normalize?e=r.normalize(e,p(t)):e=c(e,t)):e=c(e,t),{f:n?n+"!"+e:e,n:e,p:r}}function g(e){return function(){return a&&a.config&&a.config[e]||{}}}var i,s,o={},u={},a={},f={},l=[].slice;i=function(e,t,n,i){var s,a,l,c,p,y=[],b;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(p=0;p<t.length;p+=1){c=m(t[p],i),a=c.f;if(a==="require")y[p]=h(e);else if(a==="exports")y[p]=o[e]={},b=!0;else if(a==="module")s=y[p]={id:e,uri:"",exports:o[e],config:g(e)};else if(o.hasOwnProperty(a)||u.hasOwnProperty(a))y[p]=v(a);else if(c.p)c.p.load(c.n,h(i,!0),d(a),{}),y[p]=o[a];else if(!f[a])throw new Error(e+" missing "+a)}l=n.apply(o[e],y);if(e)if(s&&s.exports!==r&&s.exports!==o[e])o[e]=s.exports;else if(l!==r||!b)o[e]=l}else e&&(o[e]=n)},e=t=s=function(e,t,n,o,u){return typeof e=="string"?v(m(e,t).f):(e.splice||(a=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=o,o=u),o?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},15),s)},s.config=function(e){return a=e,s},n=function(e,t,n){t.splice||(n=t,t=[]),u[e]=[e,t,n]},n.amd={jQuery:!0}})(),n("../vendor/almond",function(){}),n("events",["require"],function(e){var t=function(){this.__listeners={}};return t.prototype={on:function(e,t,n){this.__listeners[e]||(this.__listeners[e]=[]),t||console.error("events.on(): The listener doesn't exist"),this.__listeners[e].push(t.bind(n?n:this))},emit:function(){var e,t=Array.prototype.slice.call(arguments);arguments.length===0&&console.error("Events.emit(): Incorrect number of parameters"),e=arguments[0];if(!this.__listeners[e])return;t.shift();for(var n=this.__listeners[e].length;n--;)this.__listeners[e][n].apply(null,t)}},t}),n("styles",["require"],function(e){var t={_styleSheet:null,addRule:function(e,t){var n=t;if(!this._styleSheet){var r=document.createElement("style");if(!document.head)return;document.head.insertBefore(r,document.head.childNodes[0]),this._styleSheet=document.styleSheets[document.styleSheets.length-1]}if(typeof t!="string"){n="";for(var r in t){if(!t.hasOwnProperty(r))continue;n+=r+": "+t[r]+";"}}this._styleSheet.insertRule(e+"{"+n+"}",0)},hasClass:function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){if(this.hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}}};return t}),n("commander",["require","events"],function(e){var t=e("events"),n=function(){this.events=new t};return n.prototype={output:function(e,t){this.events.emit("output",e||"",t||"STDOUT")},done:function(e,t){this.events.emit("done",e||"",t||"STDOUT")},info:function(e){this.events.emit("done",e)},getCommands:function(){var e=[],t;for(var n in this.commands)this.commands.hasOwnProperty(n)&&e.push(n);return e},commands:{}},n}),n("util",["require"],function(e){var t={String:{htmlEntities:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},htmlStrip:function(e){return String(e).replace(/&/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},Array:{merge:function(){var e=[];for(var t=0;t<arguments.length;t++){var n=arguments[t];for(var r=0;r<n.length;r++)e.indexOf(n[r])===-1&&e.push(n[r])}return e}}};return t}),n("shell",["require","util","commander"],function(e){var t=e("util"),n=e("commander"),r=function(e,t){this._environment={},t&&this.addCommander(t),e&&this.setTerminal(e)};return r.prototype={commanders:[],terminal:null,_environment:null,getEnv:function(e){return this._environment[e]?this._environment[e]:null},parse:function(e){var t,n=e.split(" ");return t=n[0],n.shift(),{command:t,args:n}},exec:function(e){var t;e=this.parse(e);if(this.native[e.command]){this.native[e.command].apply(this,e.args);return}for(var n=this.commanders.length;n--;){t=this.commanders[n];if(t.commands&&t.commands[e.command]){t.commands[e.command].apply(t,e.args);return}}this.terminal.print("Command '"+e.command+"' not found.","STDERR"),this.terminal.read()},output:function(e,t){t=t||"STDOUT",this.terminal.print(e,t)},done:function(e,t){e&&this.output(e,t),this.terminal.read()},info:function(e){this.terminal.setInfo(e)},setTerminal:function(e){this.terminal=e,this.terminal.events.on("read",this.exec,this)},addCommander:function(e){this.commanders.push(e),e.events.on("output",this.output,this),e.events.on("done",this.done,this),e.events.on("info",this.info,this)},"native":{history:function(){var e="",t=this.terminal.history();for(var n=0,r=t.length;n<r;n++)e+=" "+n+": "+t[n]+"\n";this.output(e),this.done()},clear:function(){this.terminal.clear(),this.terminal.read()},_autocomplete:function(e){var n=[],r=[];for(var i=this.commanders.length;i--;)r=t.Array.merge(r,this.commanders[i].getCommands());var s=new RegExp("^"+e,"i");if(arguments.length<=1)for(var i=r.length;i--;)s.test(r[i])&&n.push(r[i]);this.terminal.autocompleteProposal(n)}}},r}),n("client",["require","styles"],function(e){var t=e("styles"),n=.2;t.addRule(".terminaljs-box","		display: -webkit-box; 		display: -moz-box; 		display: -o-box; 		display: -ms-box; 		display: box; 	"),t.addRule(".terminaljs-input-line",{display:"none",clear:"both","-webkit-box-orient":"horizontal","-moz-box-orient":"horizontal","-ms-box-orient":"horizontal","-o-box-orient":"horizontal","box-orient":"horizontal"}),t.addRule(".terminaljs-input",{display:"block",outline:"none","-webkit-box-flex":"1","-moz-box-flex":"1","-ms-box-flex":"1","-o-box-flex":"1","box-flex":"1"}),t.addRule(".terminaljs .terminaljs-prompt",{"margin-right":"5px"}),t.addRule(".terminaljs-output",{clear:"both"}),t.addRule(".terminaljs-output .terminaljs-output-line",{height:"0",overflow:"hidden"}),t.addRule(".terminaljs-output .terminaljs-output-line.animate",{"-webkit-transition":"height "+n+"s ease-in-out","-moz-transition":"height "+n+"s ease-in-out","-ms-transition":"height "+n+"s ease-in-out","-o-transition":"height "+n+"s ease-in-out",transition:"height "+n+"s ease-in-out"}),t.addRule(".terminaljs-output .terminaljs-output-line.terminaljs-userinput",{"-webkit-transition":"none !important","-moz-transition":"none !important","-ms-transition":"none !important","-o-transition":"none !important",transition:"none !important"});var r={animations:!0};return r}),n("client/outputline",["require","client","styles"],function(e){var t=e("client"),n=e("styles"),r=function(e){var n,r=this.element=document.createElement("div");r.className="terminaljs-output-line "+(e||"")+(t.animations?" animate":""),n=this.outputContent=document.createElement("div"),n.className="terminaljs-output-content",r.appendChild(n),window.scrollTo(0,document.body.scrollHeight)};return r.prototype={element:null,outputContent:null,appendTo:function(e){return e.appendChild(this.element),this},setContent:function(e){this.outputContent.innerHTML=e},show:function(){var e=this,r=t.animations,i=function(){n.addClass(e.element,"visible"),e.element.style.height=r?e.outputContent.clientHeight+"px":"auto"};r?setTimeout(i,30):i()},hide:function(){n.removeClass(this.element,"visible"),this.element.style.height="0"}},r}),n("client/output",["require","events","util","client/outputline"],function(e){var t=e("events"),n=e("util"),r=e("client/outputline"),i=function(){this.element=document.createElement("div"),this.element.className="terminaljs-output"};return i.prototype={_print:function(e,t){var n=new r(t);return n.appendTo(this.element),n.setContent(e),n},appendTo:function(e){return e.appendChild(this.element),this},print:function(e,t){var r;t=t||"STDOUT";switch(t){case"STDOUT":r=this._print(n.String.htmlEntities(e).replace(/\n/g,"<br/>"),"terminaljs-stdout");break;case"STDERR":r=this._print(n.String.htmlEntities(e).replace(/\n/g,"<br/>"),"terminaljs-stderr");break;case"WEB":r=this._print(e,"terminaljs-web")}return r.show(),this},printUserInput:function(e){this._print(e,"terminaljs-userinput").show()},clear:function(){this.element.innerHTML=""}},i}),n("client/input",["require","events","styles"],function(e){var t=e("events"),n=e("styles"),r=function(e){var n=this;this.settings={editable:!1,prompt:">"};for(var r in e){if(!e.hasOwnProperty(r))continue;this.settings[r]=e[r]}this.events=new t,this.element=document.createElement("div"),this.element.className="terminaljs-input-line",this.prompt=document.createElement("div"),this.prompt.className="terminaljs-prompt",this.element.appendChild(this.prompt),this.text=document.createElement("div"),this.text.className="terminaljs-input",this.text.innerHTML="",this.element.appendChild(this.text),!this.settings.editable||(this.text.contentEditable=!0,this.text.addEventListener("keydown",function(e){window.scrollTo(0,document.body.scrollHeight);switch(e.keyCode){case 13:e.preventDefault(),e.stopPropagation(),n.events.emit("enter",n);break;case 38:n.events.emit("historyBack",n),e.preventDefault(),e.stopPropagation();break;case 40:n.events.emit("historyForward",n),e.preventDefault(),e.stopPropagation();break;case 9:n.events.emit("autocomplete",n),e.preventDefault(),e.stopPropagation()}})),this.setPrompt(this.settings.prompt)};return r.prototype={getValue:function(){var e=this.text.innerText||this.text.textContent,t=e?e.replace(/\n/g,""):"";return t=t.replace(/^\s+|\s+$/g,""),t},setValue:function(e){return this.text.innerHTML=e,this},appendTo:function(e){return e.appendChild(this.element),this},setPrompt:function(e){return this.settings.prompt=e,this.prompt.innerHTML=e,this},getPrompt:function(){return this.settings.prompt},focus:function(){return this.text.focus(),this.placeCursorToEnd(),this},clear:function(){return this.setValue(""),this},show:function(){return n.addClass(this.element,"terminaljs-box"),this},hide:function(){return n.removeClass(this.element,"terminaljs-box"),this},isVisible:function(){return this.element.style.display!=="none"&&n.hasClass(this.element,"terminaljs-box")},placeCursorToEnd:function(){var e,t;return document.createRange&&(e=document.createRange(),e.selectNodeContents(this.text),e.collapse(!1),t=window.getSelection(),t.removeAllRanges(),t.addRange(e)),this}},r}),n("terminal",["require","events","styles","commander","shell","client/output","client/input"],function(e){var t=e("events"),n=e("styles"),r=e("commander"),i=e("shell"),s=e("client/output"),o=e("client/input");n.addRule(".terminaljs",{height:"100%",padding:"10px",color:"#fff","background-color":"#111","font-family":"monospace"});var u=function(e,n){var r=this;this.element=e,this.events=new t;for(var i in n){if(!n.hasOwnProperty(i))continue;this.settings[i]=n[i]}};return u.prototype={settings:{welcome:"<p>Terminal.js 0.2<br/>Copyright 2011-2012 Ramón Lamana.</p>"},focus:function(){this.inputElement.focus()},historyInit:function(){this._historyIndex=0,this._history=[]},historyReset:function(){this._historyIndex=this._history.length},historyBack:function(){this._historyIndex--;var e=this._history[this._historyIndex];e?this.read(e):this._historyIndex=0},historyForward:function(){this._historyIndex++;var e=this._history[this._historyIndex];e?this.read(e):this.historyReset()},history:function(){return this._history},read:function(e){this.inputElement.clear(),typeof e!="undefined"&&this.inputElement.setValue(e),this.inputElement.show().focus()},idle:function(){this.inputElement.hide(),this.element.focus()},print:function(e,t){t=t||"STDOUT",this.outputElement.print(e,t)},clear:function(){this.outputElement.clear()},enter:function(e){var t=e.getValue();this._printInput(),this.idle();if(t===""){this.read();return}this._history.push(t),this.historyReset(),this.events.emit("read",t)},autocomplete:function(){this.events.emit("read","_autocomplete "+this.inputElement.getValue())},autocompleteProposal:function(e){e.length>1?(this._printInput(),this.print(e.join(" "),"STDOUT"),this.read(this.inputElement.getValue())):e.length===1&&this.read(e[0])},setPrompt:function(e){this.inputElement.setPrompt(e)},setInfo:function(e){this.infoElement.setContent(info)},_printInput:function(){var e=new o;e.setPrompt(this.inputElement.getPrompt()).setValue(this.inputElement.text.innerHTML).show(),this.outputElement.printUserInput(e.element.outerHTML)}},u.Commander=r,u.Shell=i,u}),window.Terminal=t("terminal")})()