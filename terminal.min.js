/**
 * Copyright © 2012 Ramón Lamana
 */(function(a){"use strict";var b={String:{htmlEntities:function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},htmlStrip:function(a){return String(a).replace(/&/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},Array:{merge:function(){var a=[];for(var b=0;b<arguments.length;b++){var c=arguments[b];for(var d=0;d<c.length;d++)a.indexOf(c[d])===-1&&a.push(c[d])}return a}}};a.Util=b})(window),function(a){"use strict";var b=function(){this.__listeners={}};b.prototype={on:function(a,b,c){this.__listeners[a]||(this.__listeners[a]=[]),b||console.error("events.on(): The listener doesn't exist"),this.__listeners[a].push(b.bind(c?c:this))},emit:function(){var a,b=Array.prototype.slice.call(arguments);arguments.length===0&&console.error("Events.emit(): Incorrect number of parameters"),a=arguments[0];if(!this.__listeners[a])return;b.shift();for(var c=this.__listeners[a].length;c--;)this.__listeners[a][c].apply(null,b)}},a.Events=b}(window),function(a){"use strict";var b={_styleSheet:null,addRule:function(a,b){var c=b;if(!this._styleSheet){var d=document.createElement("style");if(!document.head)return;document.head.insertBefore(d,document.head.childNodes[0]),this._styleSheet=document.styleSheets[document.styleSheets.length-1]}if(typeof b!="string"){c="";for(var d in b){if(!b.hasOwnProperty(d))continue;c+=d+": "+b[d]+";"}}this._styleSheet.insertRule(a+"{"+c+"}",0)},hasClass:function(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},addClass:function(a,b){this.hasClass(a,b)||(a.className+=" "+b)},removeClass:function(a,b){if(this.hasClass(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}}};a.Styles=b}(window),function(a){"use strict";var b={};a.io=b}(window),function(a){"use strict";var b=function(){};b.prototype={},a.io.InputStream=b}(window),function(a){"use strict";var b=function(){};b.prototype={},a.io.OutputStream=b}(window),function(a){"use strict";var b={list:[],register:function(b){return b instanceof a.Process||console.error("Trying to register a non Process object"),this.list.push(b),this.list.length-1}},c=function(c,d,e,f){this.pid=b.register(this),this.events=new a.Events,this.inputStream=c,this.outputStream.std=d,this.outputStream.err=e,this.outputStream.web=f};c.prototype={pid:null,inputStream:null,outputStream:{std:null,err:null,web:null},toString:function(){return"[Process:"+this.pid+"]"},read:function(){this.events.emit("output",output||"",target||"STDOUT")},write:function(a,b){},exit:function(a){this.events.emit("exit",a||"0")},info:function(a){this.events.emit("done",a)}},a.Process=c}(window),function(a){"use strict";var b=function(){this.events=new a.Events};b.prototype={output:function(a,b){this.events.emit("output",a||"",b||"STDOUT")},done:function(a,b){this.events.emit("done",a||"",b||"STDOUT")},info:function(a){this.events.emit("done",a)},getCommands:function(){var a=[],b;for(var c in this.commands)this.commands.hasOwnProperty(c)&&a.push(c);return a},commands:{}},a.Commander=b}(window),function(a){"use strict";var b=function(a,b){this._environment={},b&&this.addCommander(b),a&&this.setTerminal(a)};b.prototype={commanders:[],terminal:null,_environment:null,getEnv:function(a){return this._environment[a]?this._environment[a]:null},parse:function(a){var b,c=a.split(" ");return b=c[0],c.shift(),{command:b,args:c}},exec:function(a){var b;a=this.parse(a);if(this.native[a.command]){this.native[a.command].apply(this,a.args);return}for(var c=this.commanders.length;c--;){b=this.commanders[c];if(b.commands&&b.commands[a.command]){b.commands[a.command].apply(b,a.args);return}}this.terminal.print("Command '"+a.command+"' not found.","STDERR"),this.terminal.read()},output:function(a,b){b=b||"STDOUT",this.terminal.print(a,b)},done:function(a,b){a&&this.output(a,b),this.terminal.read()},info:function(a){this.terminal.setInfo(a)},setTerminal:function(a){this.terminal=a,this.terminal.events.on("read",this.exec,this)},addCommander:function(a){this.commanders.push(a),a.events.on("output",this.output,this),a.events.on("done",this.done,this),a.events.on("info",this.info,this)},"native":{history:function(){var a="",b=this.terminal.history();for(var c=0,d=b.length;c<d;c++)a+=" "+c+": "+b[c]+"\n";this.output(a),this.done()},clear:function(){this.terminal.clear(),this.terminal.read()},_autocomplete:function(b){var c=[],d=[];for(var e=this.commanders.length;e--;)d=a.Util.Array.merge(d,this.commanders[e].getCommands());var f=new RegExp("^"+b,"i");if(arguments.length<=1)for(var e=d.length;e--;)f.test(d[e])&&c.push(d[e]);this.terminal.autocompleteProposal(c)}}},a.Shell=b}(window),function(a){"use strict";var b=.2;a.Styles.addRule(".terminaljs-box","		display: -webkit-box; 		display: -moz-box; 		display: -o-box; 		display: -ms-box; 		display: box; 	"),a.Styles.addRule(".terminaljs-input-line",{display:"none",clear:"both","-webkit-box-orient":"horizontal","-moz-box-orient":"horizontal","-ms-box-orient":"horizontal","-o-box-orient":"horizontal","box-orient":"horizontal"}),a.Styles.addRule(".terminaljs-input",{display:"block",outline:"none","-webkit-box-flex":"1","-moz-box-flex":"1","-ms-box-flex":"1","-o-box-flex":"1","box-flex":"1"}),a.Styles.addRule(".terminaljs .terminaljs-prompt",{"margin-right":"5px"}),a.Styles.addRule(".terminaljs-output",{clear:"both"}),a.Styles.addRule(".terminaljs-output .terminaljs-output-line",{height:"0",overflow:"hidden"}),a.Styles.addRule(".terminaljs-output .terminaljs-output-line.animate",{"-webkit-transition":"height "+b+"s ease-in-out","-moz-transition":"height "+b+"s ease-in-out","-ms-transition":"height "+b+"s ease-in-out","-o-transition":"height "+b+"s ease-in-out",transition:"height "+b+"s ease-in-out"}),a.Styles.addRule(".terminaljs-output .terminaljs-output-line.terminaljs-userinput",{"-webkit-transition":"none !important","-moz-transition":"none !important","-ms-transition":"none !important","-o-transition":"none !important",transition:"none !important"});var c={animations:!0},d=function(b){var c=this;this.settings={editable:!1,prompt:">"};for(var d in b){if(!b.hasOwnProperty(d))continue;this.settings[d]=b[d]}this.events=new a.Events,this.element=document.createElement("div"),this.element.className="terminaljs-input-line",this.prompt=document.createElement("div"),this.prompt.className="terminaljs-prompt",this.element.appendChild(this.prompt),this.text=document.createElement("div"),this.text.className="terminaljs-input",this.text.innerHTML="",this.element.appendChild(this.text),!this.settings.editable||(this.text.contentEditable=!0,this.text.addEventListener("keydown",function(a){window.scrollTo(0,document.body.scrollHeight);switch(a.keyCode){case 13:a.preventDefault(),a.stopPropagation(),c.events.emit("enter",c);break;case 38:c.events.emit("historyBack",c),a.preventDefault(),a.stopPropagation();break;case 40:c.events.emit("historyForward",c),a.preventDefault(),a.stopPropagation();break;case 9:c.events.emit("autocomplete",c),a.preventDefault(),a.stopPropagation()}})),this.setPrompt(this.settings.prompt)};d.prototype={getValue:function(){var a=this.text.innerText||this.text.textContent,b=a?a.replace(/\n/g,""):"";return b=b.replace(/^\s+|\s+$/g,""),b},setValue:function(a){return this.text.innerHTML=a,this},appendTo:function(a){return a.appendChild(this.element),this},setPrompt:function(a){return this.settings.prompt=a,this.prompt.innerHTML=a,this},getPrompt:function(){return this.settings.prompt},focus:function(){return this.text.focus(),this.placeCursorToEnd(),this},clear:function(){return this.setValue(""),this},show:function(){return a.Styles.addClass(this.element,"terminaljs-box"),this},hide:function(){return a.Styles.removeClass(this.element,"terminaljs-box"),this},isVisible:function(){return this.element.style.display!=="none"&&a.Styles.hasClass(this.element,"terminaljs-box")},placeCursorToEnd:function(){var a,b;return document.createRange&&(a=document.createRange(),a.selectNodeContents(this.text),a.collapse(!1),b=window.getSelection(),b.removeAllRanges(),b.addRange(a)),this}};var e=function(b){var c,d=this.element=document.createElement("div");d.className="terminaljs-output-line "+(b||"")+(a.Client.animations?" animate":""),c=this.outputContent=document.createElement("div"),c.className="terminaljs-output-content",d.appendChild(c),window.scrollTo(0,document.body.scrollHeight)};e.prototype={element:null,outputContent:null,appendTo:function(a){return a.appendChild(this.element),this},setContent:function(a){this.outputContent.innerHTML=a},show:function(){var b=this,c=a.Client.animations,d=function(){a.Styles.addClass(b.element,"visible"),b.element.style.height=c?b.outputContent.clientHeight+"px":"auto"};c?setTimeout(d,30):d()},hide:function(){a.Styles.removeClass(this.element,"visible"),this.element.style.height="0"}};var f=function(){this.element=document.createElement("div"),this.element.className="terminaljs-output"};f.prototype={_print:function(a,b){var c=new e(b);return c.appendTo(this.element),c.setContent(a),c},appendTo:function(a){return a.appendChild(this.element),this},print:function(b,c){var d;c=c||"STDOUT";switch(c){case"STDOUT":d=this._print(a.Util.String.htmlEntities(b).replace(/\n/g,"<br/>"),"terminaljs-stdout");break;case"STDERR":d=this._print(a.Util.String.htmlEntities(b).replace(/\n/g,"<br/>"),"terminaljs-stderr");break;case"WEB":d=this._print(b,"terminaljs-web")}return d.show(),this},printUserInput:function(a){this._print(a,"terminaljs-userinput").show()},clear:function(){this.element.innerHTML=""}};var g=function(){this.element=document.createElement("div"),this.element.className="terminaljs-info"};g.prototype={appendTo:function(a){return a.appendChild(this.element),this},setContent:function(a){return this.element.innerHTML=a,this},clear:function(){this.element.innerHTML=""}},a.Client=c,a.ClientInput=d,a.ClientOutput=f,a.ClientInfo=g}(window),function(a){"use strict",a.Styles.addRule(".terminaljs",{height:"100%",padding:"10px",color:"#fff","background-color":"#111","font-family":"monospace"});var b=function(b,c){var d=this;this.element=b,this.events=new a.Events;for(var e in c){if(!c.hasOwnProperty(e))continue;this.settings[e]=c[e]}b.className="terminaljs",this.outputElement=new a.ClientOutput,this.outputElement.appendTo(b),this.inputElement=new a.ClientInput({editable:!0}),this.inputElement.events.on("enter",this.enter,this),this.inputElement.events.on("historyBack",this.historyBack,this),this.inputElement.events.on("historyForward",this.historyForward,this),this.inputElement.events.on("autocomplete",this.autocomplete,this),this.inputElement.appendTo(b),b.addEventListener("keydown",function(a){a.ctrlKey&&a.keyCode==90&&d.read()}),this.historyInit(),this.print(this.settings.welcome,"WEB"),this.read(),b.addEventListener("click",function(a){d.inputElement.focus()})};b.prototype={settings:{welcome:"<p>Terminal.js 0.2<br/>Copyright 2011-2012 Ramón Lamana.</p>"},focus:function(){this.inputElement.focus()},historyInit:function(){this._historyIndex=0,this._history=[]},historyReset:function(){this._historyIndex=this._history.length},historyBack:function(){this._historyIndex--;var a=this._history[this._historyIndex];a?this.read(a):this._historyIndex=0},historyForward:function(){this._historyIndex++;var a=this._history[this._historyIndex];a?this.read(a):this.historyReset()},history:function(){return this._history},read:function(a){this.inputElement.clear(),typeof a!="undefined"&&this.inputElement.setValue(a),this.inputElement.show().focus()},idle:function(){this.inputElement.hide(),this.element.focus()},print:function(a,b){b=b||"STDOUT",this.outputElement.print(a,b)},clear:function(){this.outputElement.clear()},enter:function(a){var b=a.getValue();this._printInput(),this.idle();if(b===""){this.read();return}this._history.push(b),this.historyReset(),this.events.emit("read",b)},autocomplete:function(){this.events.emit("read","_autocomplete "+this.inputElement.getValue())},autocompleteProposal:function(a){a.length>1?(this._printInput(),this.print(a.join(" "),"STDOUT"),this.read(this.inputElement.getValue())):a.length===1&&this.read(a[0])},setPrompt:function(a){this.inputElement.setPrompt(a)},setInfo:function(a){this.infoElement.setContent(info)},_printInput:function(){var b=new a.ClientInput;b.setPrompt(this.inputElement.getPrompt()).setValue(this.inputElement.text.innerHTML).show(),this.outputElement.printUserInput(b.element.outerHTML)}},a.Terminal=b}(window);